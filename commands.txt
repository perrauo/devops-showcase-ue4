
# 1. Ubuntu
# Enable Windows Subsystem for Linux
# https://learn.microsoft.com/en-us/windows/wsl/install-manual
dism.exe /online /enable-feature /featurename:Microsoft-Windows-Subsystem-Linux /all /norestart

dism.exe /online /enable-feature /featurename:VirtualMachinePlatform /all /norestart

wsl --set-default-version 2

# 2. UE4 CLI
# https://docs.adamrehn.com/ue4-docker/configuration/configuring-linux

sudo apt-get install python3 python3-dev python3-pip

sudo pip3 install ue4-docker

sudo ue4-docker setup

# 3. Build Unreal image myself due to licensing image
# Specify target full otherwise you will run out of space
# Specify custom branch because relying on tag will fail to run the configure step
ue4-docker build --target full --ue-version custom -repo https://github.com/EpicGames/UnrealEngine.git -branch 4.27

# 4. Build docker image for my server
cd /mnt/c/repos/DevopsShowcase/Game/Unreal
docker build -f Dockerfile.server -t devops-showcase-server .
docker run -t devops-showcase-server


# 5. Terraform
# https://developer.hashicorp.com/terraform/tutorials/aws-get-started/install-cli
sudo apt-get update && sudo apt-get install -y gnupg software-properties-common

wget -O- https://apt.releases.hashicorp.com/gpg | \
gpg --dearmor | \
sudo tee /usr/share/keyrings/hashicorp-archive-keyring.gpg > /dev/null

gpg --no-default-keyring \
--keyring /usr/share/keyrings/hashicorp-archive-keyring.gpg \
--fingerprint

echo "deb [signed-by=/usr/share/keyrings/hashicorp-archive-keyring.gpg] \
https://apt.releases.hashicorp.com $(lsb_release -cs) main" | \
sudo tee /etc/apt/sources.list.d/hashicorp.list

sudo apt update

sudo apt-get install terraform

# 6. Setup Kubernetes in Docker
# Set the KUBECONFIG environment variable to %USERPROFILE%\.kube\config on Windows
# Create a symbolic link between ubuntu .kube\config into windows kube config for WSL
sudo ln -sf "/mnt/c/users/$windowsUser/.kube" "/home/$linuxUser/.kube"

# 7. Enable Kubernetes in Docker


# 8. Initialize Terraform
# Cd into folder containing the terraform file
cd Local
terraform init
terraform plan
terraform apply

# Deploy Docker image using kubernetes
kubectl get services
kubectl get deployments
kubectl get pods


